# 项目架构流程图

## 整体架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           Agent Skill NPM Boilerplate                        │
│                         （AI 编程助手技能 npm 分发模板）                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────┐     npm publish      ┌─────────────────┐
│   技能开发者     │ ──────────────────▶  │    npm 仓库      │
│   (Developer)   │                      │   (Registry)    │
└─────────────────┘                      └─────────────────┘
        │                                        │
        │ 基于模板开发                             │ npm install -g
        ▼                                        ▼
┌─────────────────┐                      ┌─────────────────┐
│   本模板仓库     │                      │   终端用户       │
│   (Template)    │                      │   (End User)    │
└─────────────────┘                      └─────────────────┘
```

## 安装流程

```
用户执行: npm install -g @your-org/skill-name
                    │
                    ▼
        ┌───────────────────────┐
        │   npm 下载包到本地      │
        │   node_modules/       │
        └───────────────────────┘
                    │
                    │ 触发 postinstall 钩子
                    ▼
        ┌───────────────────────┐
        │   install-skill.js    │
        │   (安装脚本)           │
        └───────────────────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ 读取 .claude-skill.json│
        │ 获取配置信息            │
        └───────────────────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ 检测安装类型            │
        │ (全局 or 项目级)        │
        └───────────────────────┘
                    │
          ┌────────┴────────┐
          ▼                 ▼
    ┌──────────┐      ┌──────────┐
    │ 全局安装  │      │ 项目安装  │
    │ -g 参数  │      │ 无 -g    │
    └──────────┘      └──────────┘
          │                 │
          ▼                 ▼
    ┌──────────┐      ┌──────────┐
    │ ~/.claude│      │ ./.claude│
    │ /skills/ │      │ /skills/ │
    └──────────┘      └──────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ 遍历启用的目标工具      │
        │ (Claude/Cursor/...)   │
        └───────────────────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ 复制文件到目标目录      │
        │ • SKILL.md (必需)     │
        │ • reference.md       │
        │ • examples.md        │
        │ • scripts/           │
        └───────────────────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ 更新 manifest 清单     │
        │ .skills-manifest.json │
        └───────────────────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │   安装完成 ✅          │
        └───────────────────────┘
```

## 卸载流程

```
用户执行: npm uninstall -g @your-org/skill-name
                    │
                    │ 触发 preuninstall 钩子
                    ▼
        ┌───────────────────────┐
        │  uninstall-skill.js   │
        │   (卸载脚本)           │
        └───────────────────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ 读取 .claude-skill.json│
        └───────────────────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ 遍历启用的目标工具      │
        └───────────────────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ 删除技能目录           │
        │ ~/.claude/skills/xxx  │
        └───────────────────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ 更新 manifest 清单     │
        └───────────────────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │   卸载完成 ✅          │
        └───────────────────────┘
```

## 核心文件关系

```
┌─────────────────────────────────────────────────────────────────┐
│                        项目文件结构                              │
└─────────────────────────────────────────────────────────────────┘

package.json ─────────────────┐
    │                         │
    │ scripts.postinstall     │ scripts.preuninstall
    ▼                         ▼
install-skill.js         uninstall-skill.js
    │                         │
    └──────────┬──────────────┘
               │
               │ require
               ▼
           utils.js
               │
               ├── getEnabledTargets()    ← 获取启用的目标工具
               ├── extractSkillName()     ← 提取技能名（去除 @scope/）
               └── detectInstallLocation() ← 检测安装位置

               │
               │ 读取配置
               ▼
      .claude-skill.json
               │
               ├── name: 技能名称
               ├── files: 需要复制的文件
               ├── hooks: 安装钩子
               └── targets: 目标工具配置
                       │
                       ├── claude-code (默认启用)
                       ├── cursor
                       ├── windsurf
                       └── aider
```

## 多工具支持

```
                    .claude-skill.json
                           │
                           │ targets 配置
                           ▼
    ┌──────────────────────────────────────────────────┐
    │                                                  │
    ▼                  ▼                  ▼            ▼
┌────────┐      ┌────────┐        ┌─────────┐    ┌────────┐
│ Claude │      │ Cursor │        │Windsurf │    │ Aider  │
│  Code  │      │        │        │         │    │        │
└────────┘      └────────┘        └─────────┘    └────────┘
    │                │                  │             │
    ▼                ▼                  ▼             ▼
~/.claude/     ~/.cursor/        ~/.windsurf/   ~/.aider/
  skills/        skills/           skills/       skills/
```

## 技能文件结构

```
~/.claude/skills/your-skill-name/
    │
    ├── SKILL.md           ← 主技能定义文件（必需）
    │       │
    │       ├── frontmatter (YAML)
    │       │     ├── name: 技能名
    │       │     ├── description: 描述（触发关键词）
    │       │     └── allowed-tools: 允许的工具
    │       │
    │       └── 内容
    │             ├── Instructions: 使用说明
    │             ├── Examples: 示例
    │             └── Best Practices: 最佳实践
    │
    ├── reference.md       ← 详细参考文档（可选）
    ├── examples.md        ← 更多示例（可选）
    └── scripts/           ← 辅助脚本（可选）
          └── config.json
```

## 开发者工作流

```
1. Fork/Clone 模板
        │
        ▼
2. 修改 package.json
   • name: @your-org/skill-name
   • description: 技能描述
        │
        ▼
3. 修改 .claude-skill.json
   • name: skill-name
   • 启用目标工具
        │
        ▼
4. 编写 SKILL.md
   • 定义技能逻辑
   • 添加示例
        │
        ▼
5. 本地测试
   $ npm test
   $ ls ~/.claude/skills/
        │
        ▼
6. 发布到 npm
   $ npm login
   $ npm publish --access public
        │
        ▼
7. 用户可以安装使用
   $ npm install -g @your-org/skill-name
```
